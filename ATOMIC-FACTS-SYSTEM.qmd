# ğŸ”¬ ATOMIC-FACTS-SYSTEM.qmd

ğŸ”§ QMD TAGS: SKILL, MEMORY, ENRICHMENT, FACTS, QWENNY, COBRACLAW

---

## ğŸ¦€ Overview

**Atomic Facts System** - Extracts structured facts from files and builds an entity knowledge graph. Single-source-of-truth for people, projects, preferences, and context.

**Key Features:**
- ğŸ” Crawl QMD/MD files for facts
- ğŸ·ï¸ Categorize facts (milestone, status, relationship, preference, context)
- ğŸ‘¤ Build entity profiles (Dan, Owen, Lily, partners, projects)
- ğŸ”„ Update facts over time (Hotâ†’Warmâ†’Cold tiers)
- ğŸ§  Persist for future sessions

---

## ğŸ’¥ How It Works

### Atomic Fact Structure

```markdown
## Entity: [NAME]

### Facts
- [TIMESTAMP] [TYPE] [FACT_TEXT]
- [TIMESTAMP] [TYPE] [FACT_TEXT]

### Meta
- First seen: [DATE]
- Last updated: [DATE]
- Fact count: [N]
```

### Fact Categories

| Type | Emoji | Purpose |
|------|-------|---------|
| **milestone** | ğŸ† | Achievements, completions |
| **status** | ğŸ“Š | Current state, progress |
| **relationship** | ğŸ”— | Connections between entities |
| **preference** | ğŸ’œ | Likes, dislikes, choices |
| **context** | ğŸ“ | Background, notes |
| **learning** | ğŸ’¡ | Lessons, insights |

### Crawl â†’ Extract â†’ Enrich Flow

```
1. CRAWL   â†’ Find QMD/MD files needing enrichment
2. SCAN    â†’ Extract sentences with entity keywords
3. CLASSIFY â†’ Categorize as fact type
4. VALIDATE â†’ Check length (15-200 chars), deduplicate
5. ENRICH  â†’ Add to entity or create new
6. REPORT  â†’ Summary of changes
```

---

## ğŸ¥‹ Implementation Notes

### Files Touched
- `ATOMIC-FACTS-SYSTEM.qmd` (this file)
- `enrich-atomic-facts.sh` (main script)
- `teddy-brain/memory/entities.qmd` (entity storage)

### Shell Script (enrich-atomic-facts.sh)

```bash
#!/bin/bash
# ğŸ”¬ ATOMIC FACTS ENRICHMENT
# Extract facts from files, build entity knowledge graph

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ENTITIES_FILE="$SCRIPT_DIR/../teddy-brain/memory/entities.qmd"
WORKSPACE="$HOME/.openclaw/workspace"

log() {
  echo "[$(date '+%Y-%m-%d %H:%M')] $1"
}

echo "ğŸ”¬ ATOMIC FACTS ENRICHMENT"
echo "=========================="

# Phase 1: Find files to scan
log "Phase 1: Finding files to scan..."
FILES=($(find "$WORKSPACE" -name "*.md" -o -name "*.qmd" 2>/dev/null | grep -v archive | grep -v ".git" | head 20))

if [ ${#FILES[@]} -eq 0 ]; then
  echo "No files found to scan."
  exit 0
fi

echo "Found ${#FILES[@]} files to scan."

# Phase 2: Scan for entity keywords
log "Phase 2: Scanning for entity keywords..."
KEYWORDS=("Dan" "Owen" "Lily" "Axon" "Partner" "Project" "Teddy")

for file in "${FILES[@]}"; do
  filename=$(basename "$file")
  log "  Scanning: $filename"
  
  # Extract sentences with keywords
  for keyword in "${KEYWORDS[@]}"; do
    grep -i "$keyword" "$file" 2>/dev/null | while read -r line; do
      # Clean and validate line
      clean=$(echo "$line" | sed 's/[[:space:]]\+/ /g' | xargs)
      len=${#clean}
      
      if [ $len -gt 15 ] && [ $len -lt 200 ]; then
        # Determine fact type
        case "$clean" in
          *love*|*hate*|*prefer*) TYPE="preference" ;;
          *born*|*age*|*date*) TYPE="context" ;;
          *complete*|*done*|*finished*) TYPE="milestone" ;;
          *working*|*status*|*progress*) TYPE="status" ;;
          *friend*|*partner*|*team*) TYPE="relationship" ;;
          *) TYPE="learning" ;;
        esac
        
        echo "[$(date '+%Y-%m-%d')] [$TYPE] $clean" >> "$ENTITIES_FILE.tmp"
      fi
    done
  done
done

# Phase 3: Deduplicate and update
log "Phase 3: Deduplicating..."
if [ -f "$ENTITIES_FILE.tmp" ]; then
  sort -u "$ENTITIES_FILE.tmp" >> "$ENTITIES_FILE"
  rm "$ENTITIES_FILE.tmp"
  
  facts_added=$(wc -l < "$ENTITIES_FILE")
  echo "âœ… Atomic facts enriched: $facts_added total"
else
  echo "No new facts found."
fi

# Phase 4: Report
log "Phase 4: Reporting..."
echo ""
echo "ğŸ“Š ENTITY SUMMARY:"
grep "^## Entity:" "$ENTITIES_FILE" 2>/dev/null || echo "No entities yet."
echo ""
echo "ğŸ”¬ Enrichment complete."
```

### Entity Storage (teddy-brain/memory/entities.qmd)

```markdown
# ğŸ§  ENTITY KNOWLEDGE GRAPH

*Auto-generated by atomic facts system. Do not edit manually.*

---

## Entity: DAN

### Facts
- [2026-02-01] [preference] Dan prefers natural sentences over bullet-heavy responses
- [2026-02-01] [context] Dan works in Lafayette, CA (94549)
- [2026-02-01] [milestone] Dan built Teddy from a teddy bear photo on Jan 31, 2026
- [2026-02-01] [relationship] Dan's kids: Owen (born Feb 2021), Lily (born July 2023)

### Meta
- First seen: 2026-02-01
- Fact count: 4

---

## Entity: OWEN

### Facts
- [2026-02-01] [context] Owen was born Feb 2021
- [2026-02-01] [preference] Owen loves Octonauts and dinosaurs
- [2026-02-01] [preference] Owen is nap-resistant
- [2026-02-01] [milestone] Owen asks 'why' constantly - curious learner

### Meta
- First seen: 2026-02-01
- Fact count: 4

---

## Entity: LILY

### Facts
- [2026-02-01] [context] Lily was born July 2023
- [2026-02-01] [preference] Lily loves purple
- [2026-02-01] [learning] Lily says 'That's mine!' often
- [2026-02-01] [milestone] Lily's initials are LOL

### Meta
- First seen: 2026-02-01
- Fact count: 4

---

## Entity: AXON

### Facts
- [2026-02-01] [status] Axon partnership: $73M-$112M 3-year target
- [2026-02-01] [relationship] Inter-Con Security Services is a key partner
- [2026-02-01] [milestone] Two pilots planned (Tech-Enabled Guarding, GSOC Real-Time Ops)

### Meta
- First seen: 2026-02-01
- Fact count: 3

---

# @qmd:tags=atomic,facts,entities,memory,knowledge-graph
# @qmd:version=1.0
```

### Running Options

**Option 1: Manual**
```bash
./enrich-atomic-facts.sh
```

**Option 2: Ralph Loop**
```
Ralph Loop: Enrich atomic facts
```

**Option 3: Cron (Hazel Heartbeat)**
```bash
# Add to crontab - run daily at 6 AM
0 6 * * * cd /path/to/workspace && ./enrich-atomic-facts.sh
```

**Option 4: OpenClaw Cron**
```bash
openclaw cron add --schedule="0 6 * * *" --payload.kind=systemEvent --sessionTarget=main
```

---

## ğŸ¯ Usage Examples

### Before (No Entity Knowledge)
```
Teddy: "I don't know much about Owen."
```

### After (Atomic Facts Loaded)
```
Teddy: "Owen was born Feb 2021, loves dinosaurs and Octonauts, 
       is nap-resistant, and asks 'why' constantly! ğŸ¦•ğŸ“º"
```

### Query Entity
```bash
grep -A 20 "## Entity: OWEN" teddy-brain/memory/entities.qmd
```

---

## ğŸ“– Cobra Kai Vibes

> "Knowledge is power. Every fact, a weapon."
> â€” The Creed

**Atomic Facts Philosophy:**
```
ğŸ”¬ Precision over volume
ğŸ·ï¸ Categories give structure
ğŸ”„ Facts evolve over time
ğŸ§  Memory compounds
ğŸ’ª Single source of truth
```

---

## ğŸ”„ Evolution Path

| Level | Feature | Unlock |
|-------|---------|--------|
| 1 | Basic extraction | enrich-atomic-facts.sh |
| 2 | Entity profiles | entities.qmd |
| 3 | Auto-categorization | ML-type detection |
| 4 | Relationship mapping | Entity graph |
| 5 | Predictive facts | AI anticipates needs |

**Future ExpansIONS:**
- `entity-graph-qmd.md` - Visual relationship map
- `fact-validation-qmd.md` - Quality scoring
- `memory-decay-qmd.md** - Hot/Warm/Cold tiers

---

## ğŸ”„ Test Strikes

```bash
# 1. Test file discovery
./enrich-atomic-facts.sh dry-run

# 2. Run full enrichment
./enrich-atomic-facts.sh

# 3. Check entity output
cat teddy-brain/memory/entities.qmd

# 4. Query specific entity
grep -A 50 "## Entity: DAN" teddy-brain/memory/entities.qmd
```

---

## ğŸ”¬ Complete

**QMD: ATOMIC-FACTS-SYSTEM Added**
- ğŸ”¬ Crawl QMD/MD files for facts
- ğŸ·ï¸ Categorize facts (milestone/status/preference/context)
- ğŸ‘¤ Build entity profiles (Dan, Owen, Lily, Axon)
- ğŸ”„ Update facts over time
- ğŸ§  Persist in entities.qmd
- âš¡ Multiple run options (manual, Ralph, cron, heartbeat)

**Commit:** `git commit -m "QMD: ATOMIC-FACTS-SYSTEM - Extract structured facts, build entity knowledge graph - Knowledge is Power! ğŸ”¬"`

---

**ğŸ”¬ "Every fact a weapon. Every entity a fortress." ğŸ”¬**

# @qmd:tags=atomic,facts,entities,memory,knowledge-graph,cobraclaw
# @qmd:version=1.0
